<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="robots" content="noindex, nofollow" />
  <title>接続できませんでした</title>
  <style>
    html,body{height:100%;margin:0}
    body{font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans JP","Hiragino Kaku Gothic ProN","Yu Gothic UI",Meiryo,sans-serif;display:grid;place-items:center;background:#f7f8fa;color:#0f172a}
    .card{width:min(480px,100%);background:#fff;border:1px solid #e5e7eb;border-radius:14px;padding:28px;text-align:center;box-shadow:0 10px 30px rgba(15,23,42,.06)}
    .icon{width:64px;height:64px;margin:2px auto 10px;display:block;color:#ef4444}
    h1{margin:0 0 8px;font-size:20px}
    .btn{appearance:none;border:1px solid #e5e7eb;background:#fff;border-radius:10px;padding:10px 14px;font-weight:600;cursor:pointer}
    .btn:hover{border-color:#cbd5e1}
    @media (prefers-color-scheme: dark){
      body{background:#0b1020;color:#e5e7eb}
      .card{background:#0f172a;border-color:#1f2a44}
      .btn{background:#111827;border-color:#1f2a44;color:#e5e7eb}
      .btn:hover{border-color:#334155}
    }
  </style>
  <!-- LIFF SDK（公式LINE想定） -->
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body>
  <main class="card" role="main" aria-labelledby="title">
    <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 2l9 16H3L12 2z" fill="currentColor" opacity=".18"/><path d="M11 9h2v5h-2v-5zm0 6h2v2h-2v-2z" fill="currentColor"/></svg>
    <h1 id="title">接続できませんでした</h1>
    <button id="closeBtn" class="btn" type="button">閉じる</button>
  </main>

  <script>
    // 公式LINEの LIFF 上でのクローズを優先。未対応環境では通常のブラウザ挙動にフォールバック。
    (function(){
      const $btn = document.getElementById('closeBtn');
      function fallbackClose(){
        try{ window.close(); }catch(e){}
        history.back();
      }
      async function closeApp(){
        if (!(window.liff && typeof liff.closeWindow === 'function')){
          return fallbackClose();
        }
        // URL パラメータ ?liffId=... があれば初期化してから close。
        const p = new URLSearchParams(location.search);
        const liffId = p.get('liffId');
        const attempt = () => { try{ liff.closeWindow(); } catch(e){ fallbackClose(); } };
        try{
          if (liffId){
            await liff.init({ liffId });
            attempt();
          } else {
            // 既に LIFF WebView 内の場合は init なしでもクローズできるケースがあるため試行
            attempt();
          }
        } catch(e){
          fallbackClose();
        }
      }
      $btn.addEventListener('click', closeApp);
    })();
  </script>
</body>
</html>
